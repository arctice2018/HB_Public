/*
1st Question:
供应商都分布在哪些国家,城市？
*/
SELECT
  Country,COUNT(*)
FROM
  Suppliers suplrs
GROUP BY 1
ORDER BY 2 DESC;

/*
2nd Question:
各个供应商提供的产品的数量分别是多少？
*/
SELECT
 suplrs.CompanyName AS suplr_name,
 COUNT(prdts.ProductName) AS count_product
FROM
  Suppliers suplrs
JOIN
  Products prdts
ON
  suplrs.SupplierID = prdts.SupplierID
GROUP BY 1
ORDER BY 2 DESC;

/*
3rd Question:
销售额最大的客户的产品都有哪些？是哪个供应商提供的货物？
*/
WITH t1 AS(
  SELECT
    custmrs.CompanyName AS customer_name,
    prdts.ProductName AS prdt_name,
    suplrs.CompanyName AS suplr_name,
    CAST(odrdtl.UnitPrice AS float)*odrdtl.Quantity*(1-odrdtl.Discount) AS total_sale
  FROM
    Customers custmrs
  JOIN
    Orders odrs
  ON
    custmrs.CustomerID = odrs.CustomerID
  JOIN
    OrderDetailes odrdtl
  ON
    odrdtl.OrderID = odrs.OrderId
  JOIN
    Products prdts
  ON
    prdts.ProductID = odrdtl.ProductID
  JOIN
    Suppliers suplrs
  ON
    suplrs.SupplierID = prdts.SupplierID
)
SELECT
  suplr_name,
  prdt_name,
  SUM(total_sale) AS sum_total_sale
FROM
  t1
GROUP BY 1,2
ORDER BY 3 DESC
LIMIT 10;
